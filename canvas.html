<html>
<head>
    <title></title>
    <script type="text/javascript">

        var context;
        var palette = Array();
        var buffer = Array();
        var width;
        var height;

        function init()
        {
             initPalette();

             element = document.getElementById('canvas');
             width = element.width;
             height = element.height;

             context = element.getContext("2d");
             
             update();
        }

        function initPalette()
        {
            for(i = 0; i < 64; i++)
            {
                palette[i] = rgbToColor((i << 2), 0, 0);
                palette[i + 64] = rgbToColor(255, (i << 2), 0);
                palette[i + 128] = rgbToColor(255, 255, (i << 2));
                palette[i + 192] = rgbToColor(255, 255, 255);
            }
        }

        function rgbToColor(r, g, b)
        {
            color = 0;

            color |= (r << 16);
            color |= (g << 8);
            color |= (b);

            return color;            
        }

        function colorToString(color)
        {
            return "#" + ("00000" + (color).toString(16)).slice(-6);
        }

        function update()
        {
            for(x = 0; x < width; x++)
                drawPixel(x, height - 1, palette[randomValue(palette.length - 1)]);

            smooth();

            requestAnimFrame(function(){
                update();
            });
        }

        function smooth()
        {
            pixels = Array(8);

            for(x = 0; x < width; x++)
            {
                for(y = 0; y < height; y++)
                {
                    pixels[0] = getPixel(x - 1, y - 1);
                    pixels[1] = getPixel(x, y - 1);
                    pixels[2] = getPixel(x + 1, y - 1);
                    pixels[3] = getPixel(x - 1, y);
                    pixels[4] = getPixel(x + 1, y);
                    pixels[5] = getPixel(x - 1, y + 1);
                    pixels[6] = getPixel(x, y + 1);
                    pixels[7] = getPixel(x + 1, y + 1);

                    pixel = average(pixels);
                    
                    drawPixel(x, y - 1, pixel);
                }
            }
        }

        function average(pixels)
        {
            rt = 0;
            gt = 0;
            bt = 0;

            for(i = 0; i < pixels.length; i++)
            {
                pixel = pixels[i];
                
                r = (pixel >> 16);
                g = (pixel >> 8) & 0xff;    
                b = (pixel) & 0xff;

                rt += r;
                gt += g;
                bt += b;
            }

            return rgbToColor(
                rt / pixels.length,
                gt / pixels.length,
                bt / pixels.length);
        }

        function drawPixel(x, y, color)
        {
            index = width * (y - 1) + x;   
            buffer[index] = color;        

            context.fillStyle = colorToString(color);
            context.fillRect(x, y, 1, 1);
        }

        function getPixel(x, y)
        {
            index = width * (y - 1) + x;           
            value = buffer[index];
            return (value == null) ? 0 : value;
        }

        function randomValue(max)
        {
            return Math.round(Math.random() * max);
        }

        window.onload = function(){
            init();
        };

        window.requestAnimFrame = (function(callback){
            return window.requestAnimationFrame ||
            window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame ||
            window.oRequestAnimationFrame ||
            window.msRequestAnimationFrame ||
            function(callback){
                window.setTimeout(callback, 1000 / 60);
            };
        })();
 
    </script>
</head>
<body>
<canvas id="canvas" width="200" height="200"></canvas>
</body>
</html>